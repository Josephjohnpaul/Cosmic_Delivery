import { type Product, type InsertProduct, type CartItem, type InsertCartItem } from "@shared/schema";
import { randomUUID } from "crypto";

export interface IStorage {
  getProducts(): Promise<Product[]>;
  getExclusiveProducts(): Promise<Product[]>;
  getProduct(id: string): Promise<Product | undefined>;
  createProduct(product: InsertProduct): Promise<Product>;
  getCartItems(sessionId: string): Promise<(CartItem & { product: Product })[]>;
  addToCart(cartItem: InsertCartItem): Promise<CartItem>;
  removeFromCart(sessionId: string, productId: string): Promise<void>;
  clearCart(sessionId: string): Promise<void>;
}

export class MemStorage implements IStorage {
  private products: Map<string, Product>;
  private cartItems: Map<string, CartItem>;

  constructor() {
    this.products = new Map();
    this.cartItems = new Map();
    this.initializeProducts();
  }

  private initializeProducts() {
    const defaultProducts: Product[] = [
      {
        id: "1",
        name: "Premium Coffee Beans",
        price: "‚Çπ2,47,50,000",
        image: "‚òï",
        description: "Freshly roasted coffee beans from Earth, delivered with temperature-controlled cosmic pods.",
        planet: "Mars",
        breakdown: {
          "Base Price": "‚Çπ500",
          "Space Bureaucracy Fee": "‚Çπ45,00,000",
          "Alien Customs Bribe": "‚Çπ67,00,000",
          "Rocket Fuel Surcharge": "‚Çπ89,50,000",
          "Cosmic Insurance (Coffee Spillage)": "‚Çπ33,99,500",
          "Asteroid Belt Navigation Tax": "‚Çπ12,00,000"
        },
        isExclusive: 0
      },
      {
        id: "2",
        name: "Gaming Laptop",
        price: "‚Çπ47,99,99,999",
        image: "üíª",
        description: "High-performance gaming laptop with anti-cosmic ray shielding and zero-gravity cooling system.",
        planet: "Jupiter",
        breakdown: {
          "Base Price": "‚Çπ1,50,000",
          "Intergalactic WiFi Setup": "‚Çπ15,67,89,999",
          "Anti-Gravity Mouse Pad": "‚Çπ8,45,00,000",
          "Jupiter Storm Coverage": "‚Çπ12,34,60,000",
          "RGB Lighting Permit": "‚Çπ9,99,99,000",
          "Alien Gamer Registration": "‚Çπ1,52,00,000"
        },
        isExclusive: 0
      },
      {
        id: "3",
        name: "Margherita Pizza",
        price: "‚Çπ12,34,567",
        image: "üçï",
        description: "Fresh pizza kept warm during the journey with our patented cosmic oven technology.",
        planet: "Venus",
        breakdown: {
          "Base Price": "‚Çπ400",
          "Hot Planet Delivery Surcharge": "‚Çπ4,56,000",
          "Cheese Melting Prevention": "‚Çπ5,67,890",
          "Volcanic Ash Insurance": "‚Çπ1,23,456",
          "Toppings Import Tax": "‚Çπ87,821"
        },
        isExclusive: 0
      },
      {
        id: "4",
        name: "Indoor Plant",
        price: "‚Çπ89,76,543",
        image: "ü™¥",
        description: "Living plant with artificial atmosphere bubble and UV protection dome.",
        planet: "Saturn",
        breakdown: {
          "Base Price": "‚Çπ200",
          "Photosynthesis Permit": "‚Çπ34,56,000",
          "Ring-dodging Navigation": "‚Çπ23,45,678",
          "Oxygen Bubble Maintenance": "‚Çπ31,74,665"
        },
        isExclusive: 0
      },
      {
        id: "5",
        name: "Smartphone",
        price: "‚Çπ15,67,89,012",
        image: "üì±",
        description: "Latest smartphone with cosmic signal booster and meteor-proof case.",
        planet: "Neptune",
        breakdown: {
          "Base Price": "‚Çπ80,000",
          "Interplanetary Roaming": "‚Çπ7,89,12,345",
          "Cosmic Signal Amplifier": "‚Çπ4,56,78,901",
          "Frozen Moon Protection": "‚Çπ2,34,56,789",
          "Ice Crack Screen Insurance": "‚Çπ87,60,977"
        },
        isExclusive: 0
      },
      {
        id: "6",
        name: "Chocolate Bar",
        price: "‚Çπ3,45,678",
        image: "üç´",
        description: "Delicious chocolate bar with anti-melting nano-coating for space travel.",
        planet: "Mars",
        breakdown: {
          "Base Price": "‚Çπ50",
          "Cocoa Bean Import License": "‚Çπ1,23,456",
          "Anti-Melting Technology": "‚Çπ87,654",
          "Red Planet Landing Fee": "‚Çπ1,34,518"
        },
        isExclusive: 0
      },
      {
        id: "7",
        name: "Running Shoes",
        price: "‚Çπ23,45,67,890",
        image: "üëü",
        description: "Athletic shoes with anti-gravity soles and magnetic grip technology.",
        planet: "Jupiter",
        breakdown: {
          "Base Price": "‚Çπ5,000",
          "Anti-Gravity Sole Technology": "‚Çπ12,34,56,789",
          "Magnetic Grip Installation": "‚Çπ6,78,90,123",
          "Jupiter Pressure Testing": "‚Çπ4,32,15,978"
        },
        isExclusive: 0
      },
      {
        id: "8",
        name: "Sunglasses",
        price: "‚Çπ8,76,54,321",
        image: "üï∂Ô∏è",
        description: "Designer sunglasses with cosmic UV protection and solar flare filters.",
        planet: "Venus",
        breakdown: {
          "Base Price": "‚Çπ2,500",
          "Solar Flare Filtering": "‚Çπ4,32,10,987",
          "Fashion Police Permit": "‚Çπ3,21,09,876",
          "Cool Factor Insurance": "‚Çπ1,23,30,958"
        },
        isExclusive: 0
      },
      {
        id: "9",
        name: "Wireless Headphones",
        price: "‚Çπ8,99,99,999",
        image: "üéß",
        description: "Noise-cancelling headphones that can block out rocket engines and alien screams.",
        planet: "Mars",
        breakdown: {
          "Base Price": "‚Çπ12,000",
          "Silence License Fee": "‚Çπ3,45,67,890",
          "Alien Scream Filtering": "‚Çπ2,67,89,123",
          "Rocket Engine Noise Blocker": "‚Çπ2,84,42,986"
        },
        isExclusive: 0
      },
      {
        id: "10",
        name: "Electric Toothbrush",
        price: "‚Çπ45,67,890",
        image: "ü™•",
        description: "Rechargeable toothbrush with cosmic plaque removal and space-grade bristles.",
        planet: "Saturn",
        breakdown: {
          "Base Price": "‚Çπ3,500",
          "Space Dentist Approval": "‚Çπ15,64,390",
          "Cosmic Plaque Research": "‚Çπ12,00,000",
          "Ring Particle Removal": "‚Çπ18,00,000"
        },
        isExclusive: 0
      },
      {
        id: "11",
        name: "Yoga Mat",
        price: "‚Çπ23,45,678",
        image: "üßò",
        description: "Anti-slip yoga mat designed for zero-gravity meditation sessions.",
        planet: "Neptune",
        breakdown: {
          "Base Price": "‚Çπ2,000",
          "Zero-G Certification": "‚Çπ8,43,678",
          "Meditation License": "‚Çπ6,00,000",
          "Spiritual Alignment Fee": "‚Çπ9,00,000"
        },
        isExclusive: 0
      },
      {
        id: "12",
        name: "Water Bottle",
        price: "‚Çπ12,34,567",
        image: "üçº",
        description: "Insulated water bottle that prevents water from floating away in zero gravity.",
        planet: "Venus",
        breakdown: {
          "Base Price": "‚Çπ800",
          "Anti-Gravity Liquid Lock": "‚Çπ4,33,767",
          "Heat Resistant Coating": "‚Çπ3,00,000",
          "Hydration Permit": "‚Çπ5,00,000"
        },
        isExclusive: 0
      }
    ];

    const exclusiveProducts: Product[] = [
      // Mars Exclusives
      {
        id: "101",
        name: "Martian Rock Candy",
        price: "‚Çπ12,345",
        image: "üç≠",
        description: "Sweet crystalline candy made from actual Martian minerals. Tastes like iron with a hint of adventure!",
        planet: "Mars",
        breakdown: {
          "Local Mining": "‚Çπ8,000",
          "Crystallization Process": "‚Çπ3,000",
          "Martian Labor": "‚Çπ1,000",
          "Local Taxes": "‚Çπ345"
        },
        isExclusive: 1
      },
      {
        id: "102",
        name: "Red Dust Souvenir Jar",
        price: "‚Çπ9,876",
        image: "üè∫",
        description: "Authentic Martian red dust in a decorative jar. Perfect for your Earth garden!",
        planet: "Mars",
        breakdown: {
          "Dust Collection": "‚Çπ6,000",
          "Quality Testing": "‚Çπ2,500",
          "Jar Manufacturing": "‚Çπ1,000",
          "Martian Export License": "‚Çπ376"
        },
        isExclusive: 1
      },
      {
        id: "103",
        name: "Rust-Flavored Water",
        price: "‚Çπ15,432",
        image: "üß™",
        description: "Naturally oxidized water with that authentic Mars taste. Rich in iron!",
        planet: "Mars",
        breakdown: {
          "Water Extraction": "‚Çπ10,000",
          "Rust Flavoring": "‚Çπ3,432",
          "Health Inspection": "‚Çπ1,500",
          "Bottle Deposit": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "104",
        name: "Mini Dust Storm Generator",
        price: "‚Çπ56,789",
        image: "üå™Ô∏è",
        description: "Create your own mini dust storms at home with this Martian weather device!",
        planet: "Mars",
        breakdown: {
          "Storm Technology": "‚Çπ45,000",
          "Safety Features": "‚Çπ8,789",
          "Weather Permit": "‚Çπ2,500",
          "Assembly Instructions": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "105",
        name: "Olympus Mons Snow Globe",
        price: "‚Çπ23,456",
        image: "üèîÔ∏è",
        description: "Beautiful snow globe featuring Mars' tallest volcano. Shake for dust storms!",
        planet: "Mars",
        breakdown: {
          "Miniature Volcano": "‚Çπ18,000",
          "Globe Manufacturing": "‚Çπ3,456",
          "Dust Storm Effects": "‚Çπ1,500",
          "Gift Wrapping": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "106",
        name: "Martian Sunset Paint Set",
        price: "‚Çπ18,765",
        image: "üé®",
        description: "Paint set with colors inspired by Mars' famous blue sunsets. Earth artists love it!",
        planet: "Mars",
        breakdown: {
          "Color Extraction": "‚Çπ12,000",
          "Paint Manufacturing": "‚Çπ4,765",
          "Artist License": "‚Çπ1,500",
          "Brush Set": "‚Çπ500"
        },
        isExclusive: 1
      },
      
      // Venus Exclusives
      {
        id: "107",
        name: "Venus Heat Pack",
        price: "‚Çπ23,456",
        image: "üî•",
        description: "Portable heating device powered by Venus's natural volcanic energy. Stays warm for 500 Earth years!",
        planet: "Venus",
        breakdown: {
          "Volcanic Energy Capture": "‚Çπ18,000",
          "Heat Containment Tech": "‚Çπ4,000",
          "Safety Certification": "‚Çπ1,000",
          "Local Shipping": "‚Çπ456"
        },
        isExclusive: 1
      },
      {
        id: "108",
        name: "Acid Rain Umbrella",
        price: "‚Çπ34,567",
        image: "‚òÇÔ∏è",
        description: "Specially designed umbrella that can withstand Venus's corrosive acid rain. Fashion meets function!",
        planet: "Venus",
        breakdown: {
          "Acid-Proof Material": "‚Çπ25,000",
          "Umbrella Assembly": "‚Çπ6,567",
          "Corrosion Testing": "‚Çπ2,500",
          "Style Consulting": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "109",
        name: "Sulfuric Cloud Perfume",
        price: "‚Çπ45,678",
        image: "üå´Ô∏è",
        description: "Eau de Venus - a unique fragrance capturing the essence of sulfuric clouds. Very exclusive!",
        planet: "Venus",
        breakdown: {
          "Cloud Essence Extraction": "‚Çπ35,000",
          "Perfume Manufacturing": "‚Çπ7,678",
          "Smell Testing": "‚Çπ2,500",
          "Fancy Bottle": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "110",
        name: "Pressure Cooker (Venus Edition)",
        price: "‚Çπ29,876",
        image: "üç≤",
        description: "Cook at Venus atmospheric pressure! Your food will be ready in negative time!",
        planet: "Venus",
        breakdown: {
          "Pressure Technology": "‚Çπ22,000",
          "Safety Features": "‚Çπ5,876",
          "Recipe Book": "‚Çπ1,500",
          "Warranty": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "111",
        name: "Greenhouse Gas Sampler",
        price: "‚Çπ37,654",
        image: "üí®",
        description: "Collect and study Venus's famous greenhouse gases. Educational and terrifying!",
        planet: "Venus",
        breakdown: {
          "Gas Collection Kit": "‚Çπ28,000",
          "Analysis Tools": "‚Çπ6,654",
          "Safety Equipment": "‚Çπ2,500",
          "Instructions Manual": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "112",
        name: "Lava Lamp (Real Lava)",
        price: "‚Çπ52,345",
        image: "üåã",
        description: "Authentic lava lamp made with real Venusian lava. Warning: Do not touch!",
        planet: "Venus",
        breakdown: {
          "Lava Collection": "‚Çπ40,000",
          "Lamp Assembly": "‚Çπ8,345",
          "Safety Containment": "‚Çπ3,500",
          "Warning Labels": "‚Çπ500"
        },
        isExclusive: 1
      },
      
      // Jupiter Exclusives
      {
        id: "113",
        name: "Floating Jupiter Balloon",
        price: "‚Çπ45,678",
        image: "üéà",
        description: "Helium balloon that perpetually floats in Jupiter's atmosphere. Great for atmospheric parties!",
        planet: "Jupiter",
        breakdown: {
          "Gas Extraction": "‚Çπ25,000",
          "Atmospheric Processing": "‚Çπ15,000",
          "Storm Resistance Coating": "‚Çπ5,000",
          "Local Assembly": "‚Çπ678"
        },
        isExclusive: 1
      },
      {
        id: "114",
        name: "Great Red Spot Stress Ball",
        price: "‚Çπ33,456",
        image: "üî¥",
        description: "Squeeze away your stress with this replica of Jupiter's famous storm. It's been raging for centuries!",
        planet: "Jupiter",
        breakdown: {
          "Storm Replication": "‚Çπ25,000",
          "Stress Ball Material": "‚Çπ5,456",
          "Rage Testing": "‚Çπ2,500",
          "Packaging": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "115",
        name: "Hurricane Wind Chimes",
        price: "‚Çπ28,765",
        image: "üéê",
        description: "Wind chimes that recreate the soothing sounds of Jupiter's 400mph winds. Very relaxing!",
        planet: "Jupiter",
        breakdown: {
          "Wind Sound Recording": "‚Çπ20,000",
          "Chime Manufacturing": "‚Çπ6,765",
          "Sound Quality Testing": "‚Çπ1,500",
          "Meditation Guide": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "116",
        name: "Gas Giant Inhaler",
        price: "‚Çπ67,890",
        image: "üí®",
        description: "Breathe in the atmosphere of Jupiter! Warning: Not actually breathable.",
        planet: "Jupiter",
        breakdown: {
          "Atmosphere Compression": "‚Çπ50,000",
          "Inhaler Device": "‚Çπ12,890",
          "Safety Warnings": "‚Çπ4,500",
          "Medical Disclaimer": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "117",
        name: "Magnetic Field Generator",
        price: "‚Çπ89,123",
        image: "üß≤",
        description: "Mini magnetic field generator based on Jupiter's powerful magnetosphere. Attracts everything!",
        planet: "Jupiter",
        breakdown: {
          "Magnetic Technology": "‚Çπ70,000",
          "Field Generator": "‚Çπ14,123",
          "Power Source": "‚Çπ4,500",
          "Safety Manual": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "118",
        name: "Moon Collection Set",
        price: "‚Çπ76,543",
        image: "üåï",
        description: "Miniature replicas of Jupiter's 79 moons. Collect them all! (Some assembly required)",
        planet: "Jupiter",
        breakdown: {
          "79 Mini Moons": "‚Çπ60,000",
          "Display Case": "‚Çπ12,543",
          "Assembly Kit": "‚Çπ3,500",
          "Instruction Book": "‚Çπ500"
        },
        isExclusive: 1
      },
      
      // Saturn Exclusives
      {
        id: "119",
        name: "Saturn Ring Fragment",
        price: "‚Çπ67,890",
        image: "üíç",
        description: "Authentic piece of Saturn's rings encased in a display dome. A true cosmic collector's item!",
        planet: "Saturn",
        breakdown: {
          "Ring Collection": "‚Çπ50,000",
          "Preservation Chamber": "‚Çπ12,000",
          "Authentication Certificate": "‚Çπ5,000",
          "Display Case": "‚Çπ890"
        },
        isExclusive: 1
      },
      {
        id: "120",
        name: "Hexagon Puzzle Box",
        price: "‚Çπ43,210",
        image: "üî∑",
        description: "Puzzle box inspired by Saturn's mysterious hexagonal polar storm. Can you solve it?",
        planet: "Saturn",
        breakdown: {
          "Hexagon Engineering": "‚Çπ32,000",
          "Puzzle Mechanics": "‚Çπ8,210",
          "Difficulty Testing": "‚Çπ2,500",
          "Solution Guide": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "121",
        name: "Low Density Foam",
        price: "‚Çπ23,456",
        image: "üü°",
        description: "Foam so light it would float on water, just like Saturn! Perfect for space beds.",
        planet: "Saturn",
        breakdown: {
          "Density Calculations": "‚Çπ15,000",
          "Foam Manufacturing": "‚Çπ6,456",
          "Flotation Testing": "‚Çπ1,500",
          "Comfort Rating": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "122",
        name: "Titan Methane Candle",
        price: "‚Çπ34,567",
        image: "üïØÔ∏è",
        description: "Scented candle made from Titan's methane lakes. Smells like... well, methane.",
        planet: "Saturn",
        breakdown: {
          "Methane Extraction": "‚Çπ25,000",
          "Candle Making": "‚Çπ6,567",
          "Scent Development": "‚Çπ2,500",
          "Warning Labels": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "123",
        name: "Ring Hula Hoop Set",
        price: "‚Çπ56,789",
        image: "‚≠ï",
        description: "Multiple hula hoops to recreate Saturn's ring system around your waist. Exercise in space style!",
        planet: "Saturn",
        breakdown: {
          "Multi-Ring Design": "‚Çπ42,000",
          "Space-Grade Material": "‚Çπ10,789",
          "Orbital Mechanics": "‚Çπ3,500",
          "Fitness Guide": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "124",
        name: "Shepherd Moon Pet",
        price: "‚Çπ45,678",
        image: "üêï",
        description: "Virtual pet that keeps your ring particles in line, just like Saturn's shepherd moons!",
        planet: "Saturn",
        breakdown: {
          "AI Programming": "‚Çπ35,000",
          "Virtual Pet Device": "‚Çπ7,678",
          "Shepherding Training": "‚Çπ2,500",
          "Digital Treats": "‚Çπ500"
        },
        isExclusive: 1
      },
      
      // Neptune Exclusives
      {
        id: "125",
        name: "Neptune Ice Cube Tray",
        price: "‚Çπ34,567",
        image: "üßä",
        description: "Ice cube tray that creates perfect cubes using Neptune's frozen methane. Never melts!",
        planet: "Neptune",
        breakdown: {
          "Methane Collection": "‚Çπ20,000",
          "Freezing Technology": "‚Çπ10,000",
          "Perpetual Cold System": "‚Çπ4,000",
          "Manufacturing": "‚Çπ567"
        },
        isExclusive: 1
      },
      {
        id: "126",
        name: "Diamond Rain Collector",
        price: "‚Çπ89,123",
        image: "üíé",
        description: "Collect actual diamond rain from Neptune's atmosphere! Results may vary.",
        planet: "Neptune",
        breakdown: {
          "Rain Collection System": "‚Çπ70,000",
          "Diamond Processing": "‚Çπ15,123",
          "Quality Assurance": "‚Çπ3,500",
          "Gemologist Certificate": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "127",
        name: "Supersonic Wind Bottle",
        price: "‚Çπ76,543",
        image: "üå™Ô∏è",
        description: "Bottled winds from Neptune's supersonic storms. Fastest winds in the solar system!",
        planet: "Neptune",
        breakdown: {
          "Wind Capture": "‚Çπ60,000",
          "Pressure Bottling": "‚Çπ12,543",
          "Speed Certification": "‚Çπ3,500",
          "Caution Labels": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "128",
        name: "Deep Blue Paint",
        price: "‚Çπ23,456",
        image: "üé®",
        description: "Paint that captures Neptune's beautiful deep blue color. Perfect for ocean-themed rooms!",
        planet: "Neptune",
        breakdown: {
          "Color Analysis": "‚Çπ15,000",
          "Paint Manufacturing": "‚Çπ6,456",
          "Blue Certification": "‚Çπ1,500",
          "Artist Approval": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "129",
        name: "Triton Geyser Water Gun",
        price: "‚Çπ45,678",
        image: "üî´",
        description: "Water gun that shoots with the pressure of Triton's nitrogen geysers. Super soaker 3000!",
        planet: "Neptune",
        breakdown: {
          "Geyser Technology": "‚Çπ35,000",
          "Water Gun Assembly": "‚Çπ7,678",
          "Pressure Testing": "‚Çπ2,500",
          "Safety Features": "‚Çπ500"
        },
        isExclusive: 1
      },
      {
        id: "130",
        name: "Retrograde Orbit Spinner",
        price: "‚Çπ67,890",
        image: "üîÑ",
        description: "Fidget spinner that rotates backwards like Triton's orbit. Confuses everyone!",
        planet: "Neptune",
        breakdown: {
          "Reverse Engineering": "‚Çπ50,000",
          "Spinner Manufacturing": "‚Çπ12,890",
          "Confusion Testing": "‚Çπ4,500",
          "Instruction Manual": "‚Çπ500"
        },
        isExclusive: 1
      }
    ];

    [...defaultProducts, ...exclusiveProducts].forEach(product => {
      this.products.set(product.id, product);
    });
  }

  async getProducts(): Promise<Product[]> {
    return Array.from(this.products.values()).filter(p => p.isExclusive === 0);
  }

  async getExclusiveProducts(): Promise<Product[]> {
    return Array.from(this.products.values()).filter(p => p.isExclusive === 1);
  }

  async getProduct(id: string): Promise<Product | undefined> {
    return this.products.get(id);
  }

  async createProduct(insertProduct: InsertProduct): Promise<Product> {
    const id = randomUUID();
    const product: Product = { 
      ...insertProduct, 
      id,
      isExclusive: insertProduct.isExclusive ?? 0
    };
    this.products.set(id, product);
    return product;
  }

  async getCartItems(sessionId: string): Promise<(CartItem & { product: Product })[]> {
    const items = Array.from(this.cartItems.values()).filter(item => item.sessionId === sessionId);
    return items.map(item => ({
      ...item,
      product: this.products.get(item.productId)!
    })).filter(item => item.product);
  }

  async addToCart(cartItem: InsertCartItem): Promise<CartItem> {
    const id = randomUUID();
    const item: CartItem = { ...cartItem, id };
    this.cartItems.set(id, item);
    return item;
  }

  async removeFromCart(sessionId: string, productId: string): Promise<void> {
    for (const [id, item] of Array.from(this.cartItems.entries())) {
      if (item.sessionId === sessionId && item.productId === productId) {
        this.cartItems.delete(id);
        break;
      }
    }
  }

  async clearCart(sessionId: string): Promise<void> {
    for (const [id, item] of Array.from(this.cartItems.entries())) {
      if (item.sessionId === sessionId) {
        this.cartItems.delete(id);
      }
    }
  }
}

export const storage = new MemStorage();
